<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>${capability_name}</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-L3JKMKS4NR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'G-L3JKMKS4NR');
    </script>

    <style>
        body {
            font-family: Vollkorn, Ubuntu, Optima, Segoe, Segoe UI, Candara, Calibri, Arial, sans-serif;
        }

        a {
            text-decoration: none;
        }

        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #ccc;
        }

        .tabcontent {
            display: none;
            padding: 0;
            border: 1px solid #ccc;
            border-top: none;
        }

        .review-image {
            box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 3px, rgba(0, 0, 0, 0.24) 0px 1px 2px;
            width: 400px;
            margin: 10px;
            padding: 10px
        }

        .review-image-small {
            box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 3px, rgba(0, 0, 0, 0.24) 0px 1px 2px;
            width: 180px;
            margin: 6px;
            padding: 6px;
        }

        .tab-image {
            width: 24px;
            margin: 2px;
            padding: 2px;
        }

        .tab-image-selected {
            width: 24px;
            margin: 2px;
            padding: 2px;
            border-bottom: 4px solid blue;
        }

        .group {
            margin-top: 2px;
            margin-bottom: 40px;
            padding: 20px;
            box-shadow: rgba(0, 0, 0, 0.15) 0px 2px 8px;
            overflow: hidden;
            border: 1px solid lightgrey;
        }

        .repo {
            overflow: hidden;
            margin: 10px;
            padding: 7px;
            border-radius: 6px;
            box-shadow: rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgb(209, 213, 219) 0px 0px 0px 1px inset;
        }

        .aws {
            overflow: hidden;
            margin: 10px;
            padding: 7px;
            border-radius: 6px;
            box-shadow: rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgb(209, 213, 219) 0px 0px 0px 1px inset;
        }


        .person {
            text-align: center;
            padding: 6px;
            margin: 4px;
            display: inline-block;
            font-size: 11px;
            width: 110px;
            overflow: hidden;
            white-space: nowrap;
            vertical-align: top;
        }

        .docs {
            text-align: center;
            padding: 6px;
            margin: 4px;
            display: inline-block;
            font-size: 11px;
            width: 110px;
            overflow: hidden;
            vertical-align: top;
        }

        .team {
            text-align: center;
            padding: 6px;
            margin: 8px;
            border-radius: 5px;
            display: inline-block;
            font-size: 13px;
            width: 110px;
            overflow: hidden;
            box-shadow: rgba(0, 0, 0, 0.1) 0px 4px 12px;
            white-space: nowrap;
            vertical-align: top;
            border: 2px solid grey;
            height: 140px;
        }

        .legacy-team {
            text-align: center;
            padding: 6px;
            margin: 8px;
            border-radius: 5px;
            display: inline-block;
            font-size: 13px;
            width: 110px;
            overflow: hidden;
            box-shadow: rgba(0, 0, 0, 0.1) 0px 4px 12px;
            white-space: nowrap;
            vertical-align: top;
            border: 2px dashed grey;
            height: 140px;
        }

        .number {
            display: inline-block;
            box-shadow: rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgb(209, 213, 219) 0px 0px 0px 1px inset;
            border-radius: 4px;
            padding: 15px;
            text-align: center;
            margin: 8px;
            width: 100px;
        }

        .dependency-icon {
            height: 32px;
            margin-left: 8px;
            margin-right: 8px;
            box-shadow: rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgb(209, 213, 219) 0px 0px 0px 1px inset;
            padding: 4px;
            border-radius: 5px;
        }
    </style>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <script>
        function initTab() {
            if (window.location.hash) {
                tabName = window.location.hash.substring(1);
                if (document.getElementById('tab_' + tabName)) {
                    openTab(tabName);
                }
            }
        }

        function openTab(tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            history.pushState({}, "", '#' + tabName);
            document.getElementById(tabName).style.display = "block";
            document.getElementById('tab_' + tabName).className += " active";
        }

        function initTab() {
            if (window.location.hash) {
                tabName = window.location.hash.substring(1);
                if (document.getElementById('tab_' + tabName)) {
                    openTab(tabName);
                }
            }
        }

        function openTab(tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            history.pushState({}, "", '#' + tabName);
            document.getElementById(tabName).style.display = "block";
            document.getElementById('tab_' + tabName).className += " active";
        }
    </script>
</head>
<body onload="initTab()" onhashchange="initTab()">

<script>
    const all_capabilities = ${all_capabilities};
    const capability = ${capability_data};
    const capability_targets = ${capability_targets};
    const product_reviews = ${product_reviews};
    const beebole = ${beebole};
    const planning = ${planning};
    const dependencies = ${dependencies};
    const reverse_dependencies = ${reverse_dependencies};
    const roadmap = ${roadmap};
    const tech_debt = ${tech_debt};
</script>
<div id="Header"></div>

<div style="margin: 20px;">
    <div class="tab">
        <button class="tablinks active" id="tab_HomeTab" onclick="openTab('HomeTab')">Home</button>
        <button class="tablinks" id="tab_TargetsTab" onclick="openTab('TargetsTab')">Targets</button>
        <button class="tablinks" id="tab_DiscussionsTab" onclick="openTab('DiscussionsTab')">Decisions &amp; Discussions
            (0)
        </button>
        <button class="tablinks" id="tab_ImplementationTab" onclick="openTab('ImplementationTab')">Implementation
        </button>
        <button class="tablinks" id="tab_TechDebtTab" onclick="openTab('TechDebtTab')">Tech Debt</button>
        <button class="tablinks" id="tab_DependenciesTab" onclick="openTab('DependenciesTab')">Dependencies</button>
    </div>

    <div id="HomeTab" class="tabcontent" style="display: block; padding: 10px">
        <div id="Home"></div>
    </div>
    <div id="ImplementationTab" class="tabcontent" style="padding: 10px;">
        <div id="Implementation"></div>
    </div>
    <div id="TargetsTab" class="tabcontent" style="padding: 10px;">
        <div id="Targets"></div>
    </div>
    <div id="DiscussionsTab" class="tabcontent" style="padding: 10px;">
        <div id="RFCs"></div>
    </div>
    <div id="TechDebtTab" class="tabcontent" style="padding: 10px;">
        <div id="TechDebt"></div>
    </div>
    <div id="DependenciesTab" class="tabcontent" style="padding: 10px;">
        <div id="Dependencies"></div>
    </div>
</div>

<script>
    const hightlight = ['Brand Workspaces', 'feature flagging', 'Brand Workspace', 'AWS Account', 'AWS AppConfig', 'CI/CD', 'Kameleoon', 'PostHog', 'KPIs', 'Blue/Green Deployment', 'Canary Deploymen', 'A/B Testing', 'Feature Flagging', 'Chargebee', 'Recurly', 'Purchasely', 'data model', 'OCR', 'COCO', 'YOLO', 'AWS', 'SEO', 'Brand_B', 'Brand_A', 'SeLoger', 'Logic-Immo', 'Immoweb', 'M2M', 'SSR', 'Terraform', 'Terragrunt', 'SonarCloud', 'CircleCI', 'SonarLint', 'Lambda', 'OpenAPI', 'ml-lib', 'Redis', 'TLS', 'SSL', 'ECR', 'monorepo', 'Fortinet', 'Firewall', 'SecretManager', 'Classified', 'Github Flow', 'GitHub Actions', 'GitHub', 'Changeset', 'S3', 'BFF', 'CRM', 'B2C', 'B2B', 'Apple', 'Google Analytics', 'Google', 'Stripe', 'database', 'CuCa', 'Jira', 'Confluence', 'Cronjob', 'CNA', 'backup', 'Backstage', 'Roadie', 'Swagger', 'Datadog', 'Renovate', 'AuthN/Z', 'GA4', 'GA3', 'SDK', 'Intermediary ID', "IDs", 'Mulesoft Anypoint', 'Mulesoft', 'Okta', 'CORS', 'FQDN', 'HTTPOnly', 'OAuth', 'HTTP', 'PKCE', 'Bitrise CI', 'QA', 'Github', 'Digital Services Act', 'DSA', 'Lokalize', 'iOS', 'Android', 'Universal Placeholders', 'SNS', 'SQS', 'event streaming', 'Kinesis Firehose', 'Kinesis Data Stream', 'Kinesis', 'MSK', 'Amazon', 'PII', 'Accessibility', 'Lighthouse CI', 'Core Web Vitals', 'GDPR', 'ECS', 'Fargate', 'React Hook', 'Formik', 'React', 'NodeJS', 'NextJS', 'DynamoDB', 'API Gateway', 'API Management', 'API', 'GeoApi', 'Python', 'TypeScript', 'Mapbox', 'mapbox', 'JupyterlabExtensions', 'Jupyter', 'Spark', 'LakeFormation', 'SentinelOne', 'Auth0', 'Cognito', 'RBAC', 'Role-Based Access Control', 'CircleCi', 'CodeBuild', 'SQL', 'CodeArtifact', 'MFE', 'CDKTF', 'A/B testing', 'DNS', 'ACL', 'C#', 'DDoS', 'i18n', 'JSON', 'CMS', 'MVP', 'Test scenarios', 'ACT', 'SSoT', 'SSOT', 'micro frontend', 'dependencies', 'dependency', 'package.json', 'dynamodb', 'Sold Property', 'Sold Properties', 'Gemini', 'ChatGPT', 'CloudFormation', 'VPC', 'mTanService', 'Meilleurs Agents', 'NX', 'GSL', 'IWT', 'IMN', 'IWB', 'FRSBO', 'FSBO', 'fraud', 'churn', 'Algorithm', 'algorithm', 'event model', 'responsiveness', 'EventBridge', 'Cloudwatch', 'Nest.js', 'Cache', 'Typescript', 'Eslint', 'Code Style', 'Cypress', 'authentication', 'authentication flow', 'mobile', 'authorization', 'DynamoDb', 'OWASP', 'DDOS', 'Cloudfront', 'Datadome', 'France', 'Germany', 'Belgium', 'robots.txt', 'URL', 'URLs', 'WAF', 'visual testing', 'EKS', 'Hangfire', 'IAM', 'Security Assessment', 'Security Architecture', 'security architecture', 'security group', 'security posture', 'cipher', 'security', 'security', 'RCA', 'Design System', 'distributed tracing', 'user monitoring', 'Tagging', 'tagging', 'validation logic', 'Language translation', 'Node.js', 'legacy', 'CDNs', 'APIs', 'Ultranotif', 'Client-side rendering', 'client-side rendering', 'Server-side rendering', 'server-side rendering', 'NFRs', 'NFR', '99.9%', 'micro-frontend architecture', 'antivirus check', 'Antivirus check', 'OTP', 'CloudImage', 'Flamingo', 'datalake', 'property model', 'Property Model', 'historization', 'brands specification', 'geo configuration', 'GeoRef', 'Salesforce', 'Marketing Cloud', 'Legal constraints', 'legal constraints', '30%', '10%', 'Data Domain', 'Naming Convention', 'Git', 'Unified Contract Gateway', 'Unified Contracts Gateway', 'Uber', 'Airbnb', 'Zillow', 'machine learning', 'legal', 'French', 'infrastructure', 'UUID', 'non-registered user', 'Zero Trust', 'separate user pools', 'user pool', 'OAuth', 'excellent cooperation', 'Obsevability', 'Traces', 'Context propagation', 'Sampling mechanisms', 'instrumentation', '.net Core', '.net', 'Cassiopeia', 'non-breaking changes', 'Breaking changes', 'Monthly license fee', 'monthly license fee', 'operational, analytical, and historical data', 'historical data', 'transition strategy', 'product strategy', 'financial profile', 'financial', 'Axe devtools', 'property probability prediction', 'customising per brand', 'Bitrise', 'IDEs', 'The decision is', 'Tableau', 'is chosen', 'reconciliation process', 'confidential', 'environment variables', 'configuration parameters', 'sending notifications to users', 'model', 'Event notification', 'Event carried state', 'data product', 'Business & Contractual Score', 'real-time', 'tier-based', 'critical issues were absent', 'testing framework', 'harmonized ranking', 'Relevancy sort order', 'Scala', 'Model training', 'dataset', 'seeker fit score', 'Seeker FeedBackLoop Schema', 'lambda', 'GET', 'POST', 'Bounded context', 'SANDBOX', 'DEV', 'PREVIEW', 'LIVE', 'concrete implemention', 'idempotent', 'idempotency', 'event consumer', 'event producer', 'data integrity', 'Organisation Decision Record', 'ODR', 'unified convention', 'structured approach', 'guide on documenting a system', 'anti-pattern', 'best practices', 'PNPM', 'NPM', 'arc42', 'third-party tools', 'AAPSC', 'R-Audit', 'Reacj.js', 'Suspense', 'single reference point of operational data', 'Single Source of Truth', 'plug-and-play', 're-brandable', 'Private and Pro user', 'Localise', 'Tone of Voice', 'Pagination', 'Lokalise', 'SageMaker', 'Event Bridge', 'Lake Formation', 'data compliance', 'Ultimmo', 'Plato', 'touchpoints', 'pricing', 'billing', 'Cancellations', 'lead categorization', 'lead score', 'research repository', 'payment platform', 'payment method', 'payment processing', 'payment provider', 'standardization', ' npm ', 'Gherkin', 'multi-channel payment', 'in-app purchase', 'web direct payment', 'webhook', 'CDK', 'IaC', 'Monorepo', 'pnpm', 'Prettier', 'ESLint', 'microfrontend', 'CloudFront', 'serverless architecture', 'event-driven', 'ImmoWeb', 'microservices architecture', 'upstream and downstream', 'backward compatibility', 'inter-service communication', 'event-carrier state', 'encryption', 'least-privilege', 'sensitive data', 'CQRS', 'Aurora', 'Serverless', 'multiple tenants', 'knowledge sharing', 'Anypoint', 'Flex Gateway', 'delivery platform', 'metadata'];
</script>

<script>
    function isFalse(value) {
        return !value || (value + '').toLowerCase().trim() === 'false' || (value + '').toLowerCase().trim() === 'no';
    }

    function isTrue(value) {
        return !isFalse(value);
    }

    function displayTable(roadmap) {
        let html = '';
        html += '<table>';
        html += '<tr>';
        html += '<td>';
        html += '<table style="display: inline-block; vertical-align: top">';
        html += '<tr style="font-size: 10px">';
        html += '<td></td>';
        html += '<td></td>';
        roadmap.months.forEach(month => {
            if (month.month === 6) {
                html += '<td colspan="2" style="text-align: center">' + month.year + '</td>';
            } else if (month.month === 7 && month.year > 2022) {
            } else {
                html += '<td></td>';
            }
        });
        html += '</tr>';
        html += '<tr style="font-size: 80%">';
        html += '<td>';
        html += '</td>';
        roadmap.months.forEach(month => {
            html += '<td>' + month.month + '</td>';
        });
        html += '</tr>';
        html += '<tr style="font-size: 50%">';
        html += '<td></td>';
        html += '</tr>';

        let index = 0;
        html += '<tr style="height: 32px;">';
        html += '<td>';
        html += '<div class="number" style="vertical-align: bottom">';
        html += '<div style="font-size: 43px">' + Math.round(roadmap.man_months / 12);
        html += '<span style="color: #b0b0b0; font-size: 80%">MY</span></div>';
        html += '<div style="font-size: 14px; color: #b0b0b0">(estimated<br>total&nbsp;effort)</div>';
        html += '</div>';
        html += '</td>';
        roadmap.months.forEach(month => {
            const monthId1 = month.year + '-' + (month.month < 10 ? '0' : '') + (month.month);
            const monthId2 = month.year + '-' + month.month;

            const border = month.month === 12 ? 'border-right: 1px solid lightgrey' : '';
            html += '<td style="border-bottom: 1px solid lightgrey; vertical-align: bottom; text-align: left; ' + border + '">';

            const title = month.year + ' ' + month.month
                + '\nbuilding: ' + month.buildEffort + ' FTE'
                + '\nscaling: ' + month.scalingEffort + ' FTE'
                + '\nretiring: ' + month.retiringEffort + ' FTE';

            const lineStyle =
                ((monthId1 === capability.confirmed_live || monthId2 === capability.confirmed_live) ? 'border: 3px solid crimson;' :
                    (monthId1 === capability.expected_live || monthId2 === capability.expected_live) ? 'border: 3px dotted crimson;' : '');

            html += '<div style="display: inline-block; cursor: help; vertical-align: bottom;' + lineStyle + '" title="' + (title) + '">';
            html += '<div style="border-radius: 1px; background-color: #b0b0b0; width: 20px; height: ' + (month.retiringEffort * 3) + 'px">&nbsp;</div>';
            html += '<div style="border-radius: 1px; background-color: orange; width: 20px; height: ' + (month.scalingEffort * 3) + 'px">&nbsp;</div>';
            html += '<div style="border-radius: 1px; background-color: #315b7c; width: 20px; height: ' + (month.buildEffort * 3) + 'px">&nbsp;</div>';
            html += '</div>';

            html += '</td>';
        });
        html += '</tr>';
        if (beebole && beebole.length) {
            html += '<tr>';
            html += '<td style="vertical-align: top">';
            if (beebole && beebole.length) {
                const totalFTEs = beebole.map((b => b.fte)).reduce((a, b) => a + b);
                html += '<div class="number">';
                html += '<div style="font-size: 43px; color: #1ccfc9">' + Math.round(totalFTEs / 12);
                html += '<span style="color: #b0b0b0; font-size: 80%">MY</span></div>';
                html += '<div style="font-size: 14px; color: #b0b0b0">(reported<br>effort)</div>';
                html += '</div>';
                html += '</div>';
            }
            html += '</td>';
            roadmap.months.forEach(month => {
                const monthId1 = month.year + '-' + (month.month < 10 ? '0' : '') + (month.month);
                const monthId2 = month.year + '-' + month.month;
                const border = month.month === 12 ? 'border-right: 1px solid lightgrey' : '';
                html += '<td style="border-bottom: 1px solid lightgrey; vertical-align: top; text-align: left;' + border + '">';
                beebole.forEach(b_item => {
                    if (b_item.year + '' === month.year + '' && (b_item.month + '' === month.month + '' || b_item.month + '' === '0' + month.month)) {
                        const border = b_item.month === 12 ? 'border-right: 1px solid lightgrey' : '';
                        let fte = Math.round(b_item.fte);
                        let title = b_item.year + ' ' + b_item.month + ': ' + fte + ' FTEs';
                        if (b_item.people) {
                            title += '\n\n';
                            title += 'People (' + b_item.people.length + '):'
                            b_item.people.sort((a, b) => b.days - a.days).forEach(person => {
                                title += '\n\t';
                                title += Math.round(person.days) + 'd\t' + person.person
                            });
                        }
                        html += '<div style="border-radius: 1px; background-color: #1ccfc9; width: 20px; cursor: help; height: ' + (fte * 3) + 'px" title="' + title
                            + '">&nbsp;</div>';
                    }
                });
                html += '</td>';
            });
            html += '</tr>';
        }

        html += '</table>';
        html += '</td>';
        html += '</tr>';
        html += '</table>';
        return html;
    }

    function addRoadmap() {
        let html = '';

        html += '<div  class="group">';
        html += '<div style="font-size: 200%; margin-bottom: 12px"><a target="_blank" href="https://brand.comcapabilities/index.html#Progress">Roadmap</a></div>';

        if (roadmap && roadmap.length) {
            html += displayTable(roadmap[0]);
        }
        html += '</div>';

        return html;
    }

</script>

<script>
    let div = document.createElement('div');
    document.body.appendChild(div);

    let html = '';

    function addNavigation() {
        html += '<div style="margin: 20px 20px 10px 20px; font-size: 85%; color: black">';
        let prev_domain = all_capabilities[0].domain_ea;
        all_capabilities.filter(c => c.domain_ea && c.domain_ea.toLowerCase().trim() !== 'on ice').forEach(cap => {
            if (prev_domain.toLowerCase() !== cap.domain_ea.toLowerCase()) {
                prev_domain = cap.domain_ea;
                html += '<div style="margin-top: 5px; margin-left: 4px; vertical-align: top; display: inline-block; border-left: 2px solid lightgrey; height: 30px;">&nbsp;</div>';
            }
            let title = '[' + cap.domain_ea.toLowerCase() + ']\n' + cap.capability.toUpperCase();
            if (cap.short_description) title += '\n\n' + cap.short_description;

            html += '<a href="' + cap.id + '.html" title="' + title + '">';
            const tabClass = cap.id === capability.id ? 'tab-image-selected' : 'tab-image';
            const style = isTrue(cap.in_flight) ? '' : 'opacity: 0.2';
            html += '<img src="icons/' + cap.id + '.png" style="' + style + '" class="' + tabClass + '">';
            html += '</a>';
        });
        html += '</div>';
    }

    addNavigation();

    html += '<div style="margin: 20px">';

    function addHeader() {
        html += '<table>';
        html += '<tr>';
        html += '<td>';
        html += '<div>';
        html += '<img src="icons/' + capability.id + '.png" style="width: 110px">';
        html += '</div>';
        html += '</td>';
        html += '<td style="vertical-align: top">';
        html += '<div style="margin-left: 20px; font-size: 90%; color: grey; vertical-align: top">';
        html += capability.domain_ea;
        html += ' / <span style="color: blue; font-weight: bold;">' + capability.code + '</span>';
        html += '</div>';
        html += '<div style="font-size: 50px; margin-left: 20px">';
        if (isFalse(capability.in_flight)) {
            html += '[Not In-Flight] ';
        }
        html += capability.capability;
        html += '</div>';
        html += '<div style="font-size: 16px; margin-left: 20px; color: grey; margin-top: 3px">';
        html += capability.short_description ? capability.short_description : '';
        html += '</div>';
        if (capability.description) {
            html += '<div style="font-size: 50px">';
            html += capability.description;
            html += '</div>';
        }
        html += '</td>';
        html += '</tr>';
        html += '</table>';
    }

    addHeader();

    function addDocs() {
        html += '<div  class="" style="margin-top: 32px">';

        function addGroup(docs, icon) {
            if (docs) {
                docs.split('\n').forEach(doc => {
                    const elements = doc.trim().split(',');
                    const label = elements.length > 0 ? elements[0].trim() : '';
                    const link = elements.length > 1 ? elements[1].trim() : '';
                    if (label && link) {
                        html += '<a target="_blank" href="' + link + '">';
                        html += '<div class="docs">';
                        html += '<div>';
                        if (label.startsWith('Security ')) icon = 'security.png';
                        html += '<img src="icons/' + icon + '" ' + 'style="width: 54px;">';
                        html += '</div>';
                        html += '<div style="font-size: 110%">' + label.replace(/_/g, ' ') + '</div>';
                        html += '</div>';
                        html += '</a>';
                    }
                });
            }
        }

        // capability.architecture_docs = 'Architectural Metamorphosis,../../metamorphosis/docs/details/' + capability.id + '.html\n';


        addGroup(capability.architecture_docs, 'architecture.png');
        addGroup('CAPEX Form,capex_form_' + capability.id + '.html', 'capex.png');
        addGroup(capability.document_links, 'docs.png');
        addGroup(capability.slack_channels, 'slack.png');
        if (capability.details_sheet_gid || capability.targets_sheet_gid || capability.architecture_sheet_gid) {
            capability.edit_docs = '';

            if (capability.details_sheet_gid) {
                const detailsSheetLink = 'https://docs.google.com/spreadsheets/d/1Gci5OGI2suMZOAizRQmGCLcelAVleLyLG9TslUPeJE8/edit#gid=' + capability.details_sheet_gid;
                capability.edit_docs += 'Edit data...,' + detailsSheetLink + '\n';
            }

            if (capability.targets_sheet_gid) {
                const targetsSheetLink = 'https://docs.google.com/spreadsheets/d/1jdZs46gngEQkD6lNyzpOLXf2z-qVYW_GiG_kZhlc9Zk/edit#gid=' + capability.targets_sheet_gid;
                capability.edit_docs += 'Edit release targets...,' + targetsSheetLink + '\n';
            }

            if (capability.discussions_sheet_gid) {
                const discussionsSheetLink = 'https://docs.google.com/spreadsheets/d/1pCQWH24fp_welPgOvN0ePNXc7VuR3wghjmd5rcu5MR4/edit#gid=' + capability.discussions_sheet_gid;
                capability.edit_docs += 'Edit decisions and discussions...,' + discussionsSheetLink + '\n';
            }

            // if (capability.architecture_sheet_gid) {
            //     const targetsSheetLink = 'https://docs.google.com/spreadsheets/d/1rXk2K1btY3s5TyxSkTFM2X5qyYAEqBLDKUUaG6kz0SU/edit#gid=' + capability.architecture_sheet_gid;
            //     capability.edit_docs += 'Edit architecture metamorphosis...,' + targetsSheetLink + '\n';
            // }

            addGroup(capability.edit_docs, 'edit.png');
        }

        html += '</div>';
    }

    function addPeople() {
        html += '<div  class="group">';
        html += '<div style="font-size: 200%; margin-bottom: 12px">Teams and People</div>';

        if (capability.teams) {
            capability.teams.trim().split('\n').forEach(t => {
                t = t.trim();
                html += '<div class="team">';
                html += '<div><img src="icons/team.png" style="width: 80px; margin-top: 16px; margin-bottom: 20px"></div>';
                html += '<div>' + t + '</div>';
                html += '</div>';
            });
        }
        if (capability.teams_maintaining_legacies) {
            capability.teams_maintaining_legacies.trim().split('\n').forEach(t => {
                t = t.trim();
                html += '<div class="legacy-team">';
                html += '<div><img src="icons/team.png" style="width: 80px; margin-top: 2px; margin-top: 16px; margin-bottom: 20px"></div>';
                html += '<div>' + t + '</div>';
                html += '</div>';
            });
        }
        if (capability.people) {
            capability.people.split('\n').forEach(person => {
                console.log(person);
                const elements = person.trim().replace(/\(/, ',').replace(/\)/, ' ').trim().split(',');
                const name = elements.length > 0 ? elements[0].trim() : '';
                const role = elements.length > 1 ? elements[1].trim() : '';
                if (name) {
                    let type = '';
                    if (role.includes('EM')) {
                        type = 'engineer';
                    } else if (role.includes('PM')) {
                        type = 'product';
                    } else if (role.toLowerCase().includes('engineer')) {
                        type = 'engineer';
                    } else if (role.toLowerCase().includes('tech')) {
                        type = 'engineer';
                    } else if (role.toLowerCase().includes('marketing')) {
                        type = 'marketing';
                    } else if (role.toLowerCase().includes('design')) {
                        type = 'designer';
                    } else if (role.toLowerCase().includes('product')) {
                        type = 'product';
                    } else if (role.toLowerCase().startsWith('pm ')) {
                        type = 'product';
                    } else if (role.toLowerCase().includes('ux')) {
                        type = 'ux';
                    } else if (role.toLowerCase().includes('architect')) {
                        type = 'architecture';
                    } else if (role.toLowerCase().includes('scientist')) {
                        type = 'science';
                    }
                    html += '<a target="_blank" href="https://brand.comworkday/index.html?filter=' + name + '">';
                    html += '<div class="person">';
                    html += '<div><img src="icons/' + type + '.png" ' +
                        'style="width: 34px;"' +
                        'onerror="this.onerror=null;this.src=\'icons/person.png\';"\n></div>';
                    html += '<div><img src="people/' + name + '.jpeg" ' +
                        'style="width: 84px; border-radius: 50%; border: 1px solid black;"' +
                        'onerror="this.onerror=null;this.src=\'icons/person.png\';"\n></div>';
                    html += '<div style="font-size: 110%">' + name + '</div>';
                    html += '<div style="font-size: 80%; color: grey">' + role + '</div>';
                    html += '</div>';
                    html += '</a>';
                }
            });
        }

        html += '</div>';
    }

    function addMilestones() {
        let html = '';
        html += '<div  class="group">';
        html += '<div style="font-size: 200%; margin-bottom: 12px">Release Targets</div>';

        if (capability_targets.length > 0) {
            const targets = capability_targets.sort((a, b) => (a.live_date_yyyy_mm + '').localeCompare(b.live_date_yyyy_mm + ''));

            const brands = [];
            const channels = [];
            targets.forEach(t => {
                if (t.brand_or_country) {
                    if (!brands.includes(t.brand_or_country)) {
                        brands.push(t.brand_or_country);
                    }
                } else if (t.capability) {
                    if (!brands.includes(t.capability)) {
                        brands.push(t.capability);
                    }
                }
                let channel = t.channel ? t.channel.toLocaleString().trim() : '';
                if (!channels.includes(channel)) {
                    channels.push(channel);
                }
            });

            function addTargetsTable() {
                html += '<table>';
                channels.forEach(channel => {
                    html += '<tr>';
                    html += '<td style="height: 22px;"></td>';
                    html += '</tr>';
                    html += '<tr>';
                    html += '<td colspan="100" style="border-top: 1px solid lightgrey; padding-top: 2px; font-size: 140%; color: #4c4c4c; text-align: center; background-color: #f0f0f0">';
                    html += channel;
                    html += '</td>';
                    html += '</tr>';
                    html += '<tr>';
                    html += '<td></td>';
                    html += '<td></td>';
                    for (let year = 2022; year <= 2026; year++) {
                        html += '<td colspan="12" style="text-align: center; border: 1px solid lightgrey">';
                        html += year;
                        html += '</td>';
                    }
                    html += '</tr>';
                    const firstDateOf = (brand) => {
                        const brandTargets = targets
                            .filter(t => t.brand_or_country === brand || t.capability === brand)
                            .filter(t => (t.channel ? t.channel.toLocaleString().trim() : '') === channel)
                            .sort((a, b) => (a.live_date_yyyy_mm + '').localeCompare(b.live_date_yyyy_mm + ''));

                        return brandTargets[0] + '';
                    }
                    brands.sort((a, b) => firstDateOf(a).localeCompare(firstDateOf(b))).forEach(brand => {
                        const brandTargets = targets
                            .filter(t => t.brand_or_country === brand || t.capability === brand)
                            .filter(t => (t.channel ? t.channel.toLocaleString().trim() : '') === channel);
                        if (brandTargets.length === 0) return;
                        const liveTargets = brandTargets.filter(t => (t.status + '').toLowerCase().startsWith('live'));
                        const partialTargets = brandTargets.filter(t => (t.status + '').toLowerCase().includes('partial'));
                        if (liveTargets.length > 0 || partialTargets.length > 0) {
                            html += '<tr>';
                        } else {
                            html += '<tr style="filter: grayscale(100%); opacity: 0.4">';
                        }
                        html += '<td>';
                        html += getBrandsCountryIcon(brand);
                        html += '</td>';
                        html += '<td>';
                        html += brand;
                        html += '</td>';

                        for (let year = 2022; year <= 2026; year++) {
                            for (let month = 1; month <= 12; month++) {
                                html += '<td style="border: 1px solid #f0f0f0">';
                                const date = year + '-' + (month < 10 ? '0' : '') + month;
                                console.log(date);
                                const monthTargets = brandTargets.filter(t => (t.live_date_yyyy_mm + '').startsWith(date));
                                if (monthTargets.length) {
                                    let status = monthTargets[0].status ? monthTargets[0].status : 'Not Live';
                                    let color = status.toLowerCase().startsWith('live') ? 'yellowgreen' : (status.toLowerCase().startsWith('partial') ? 'orange' : 'lightgrey');
                                    html += '<div style="height: 35px; width: 35px; background: ' + color + '; text-align: center; border-radius: 5px">' + '<div style="">' + (monthTargets.length > 1 ? monthTargets.length : '') + '</div></div>';
                                }
                                html += '</td>';
                            }
                        }

                        html += '</tr>';

                    });
                });
                html += '</table>';
            }


            html += '<table style="margin-top: 24px">';
            let first = true;

            let prevYear = '';


            function addTargets() {
                targets.forEach(target => {
                        const targetYear = (target.live_date_yyyy_mm + '0000').substring(0, 4);
                        let status = target.status ? target.status : 'Not Live';
                        const inProd = status !== '' && !status.toLowerCase().includes('not live');
                        if (targetYear !== prevYear) {
                            prevYear = targetYear;
                            html += '<tr><td colspan="10" style="color: blue; font-size: 120%; padding-top: 20px; border-bottom: 2px solid lightgrey">' + targetYear + '</td></tr>'
                        }
                        if (inProd) {
                            html += '<tr>';
                        } else {
                            html += '<tr style="opacity: 0.6">';
                        }
                        html += '<td style="vertical-align: middle; color: blue; text-align: center; padding-right: 0px;">';
                        if (target.channel) {
                            const channel = target.channel.toLowerCase().trim();
                            let iconLink = null;
                            if (channel.includes('mobile')) iconLink = 'icons/mobile.png';
                            if (iconLink) {
                                html += '<img src="' + iconLink + '" style="height: 35px; margin-top: 2px;">';
                            }
                        }
                        html += '</td>';
                        html += '<td style="vertical-align: middle; color: blue; text-align: center; padding-right: 12px;">';
                        if (target.brand_or_country) {
                            if (inProd) {
                                html += '<div style="margin-top: 2px;">';
                            } else {
                                html += '<div style="margin-top: 2px; filter: grayscale(100%)">';
                            }
                            html += getBrandsCountryIcon(target.brand_or_country);
                            html += '</div>';
                        }
                        html += '</td>';
                        html += '<td style="vertical-align: top;">';
                        let color = status.toLowerCase().startsWith('live') ? 'yellowgreen' : (status.toLowerCase().startsWith('partial') ? 'orange' : 'lightgrey');
                        html += '<div style="margin-top: 4px; vertical-align: top; background-color: #f0f0f0; padding: 0px; border-radius: 22px; padding-right: 8px; ">';
                        html += '<div style="background-color: ' + color + '; height: 33px; width: 33px; border-radius: 50%; display: inline-block; vertical-align: middle"></div>';
                        html += '<div style="padding-left: 4px; margin: 0; height: 25px; border-radius: 50%; display: inline-block; vertical-align: middle; font-size: 90%; padding-top: 8px; ">';
                        if (!inProd) {
                            html += '<span style="color: #8c8c8c">'
                        }
                        html += status ? status : '';
                        if (!inProd) {
                            html += '</span>'
                        }
                        html += '</div>';
                        html += '</div>';
                        html += '</td>';
                        if (inProd) {
                            html += '<td style="vertical-align: middle; color: blue; padding-right: 12px">';
                            html += target.live_date_yyyy_mm ? target.live_date_yyyy_mm : '';
                            html += '</td>';
                            html += '<td style="vertical-align: middle; color: blue; padding-right: 12px">';
                            html += (target.brand_or_country ? ' ' + target.brand_or_country : '');
                            html += '</td>';
                            html += '<td style="vertical-align: middle; color: blue; padding-right: 12px">';
                            html += target.channel ? target.channel : '';
                            html += '</td>';
                            html += '<td style="vertical-align: middle; color: blue; padding-right: 12px">';
                            html += target.capability ? target.capability : '';
                            html += '</td>';
                        } else {
                            html += '<td style="vertical-align: middle; color: #8c8c8c; padding-right: 12px">';
                            html += target.live_date_yyyy_mm ? target.live_date_yyyy_mm : '';
                            html += '</td>';
                            html += '<td style="vertical-align: middle; color: #5c5c5c; padding-right: 12px">';
                            html += 'Live ' + (target.brand_or_country ? ' ' + target.brand_or_country : '');
                            html += '</td>';
                            html += '<td style="vertical-align: middle; color: #8c8c8c; padding-right: 12px">';
                            html += target.channel ? target.channel : '';
                            html += '</td>';
                            html += '<td style="vertical-align: middle; color: #8c8c8c; padding-right: 12px">';
                            html += target.capability ? target.capability : '';
                            html += '</td>';
                        }
                        html += '<td style="vertical-align: middle; color: blue;">';
                        html += target.okr_3_1_target === 'true' ? '<img src="icons/okr.png" style="width: 20px">' : '';
                        html += '</td>';
                        html += '<td style="vertical-align: middle; color: blue; padding-right: 0px">';
                        let okrFragment = '<a target="_blank" href="../../okr-report.html">KR 2024</a>';
                        html += target.okr_3_1_target === 'true' ? okrFragment : '';
                        html += '</td>';
                        html += '<td style="vertical-align: middle; padding-left: 6px">';
                        if (target.slack_announcement_link) {
                            html += '<div style="margin-left: 12px">';
                            html += '<a href="' + target.slack_announcement_link + '" target="_blank">';
                            html += '<img src="icons/slack_announcement.png" style="height: 30px">';
                            html += '</a>';
                            html += '</div>';
                        }
                        html += '</td>';
                        html += '</tr>';
                    }
                )
                ;
                first = false;
            }

            addTargets();

            html += '</table>';
            html += '<div style="height: 102px"></div>';
            html += '<div style="font-size: 200%; margin-bottom: 12px">Release Matrix</div>';
            addTargetsTable();
        } else {
            html += '<p style="color: grey">Milestones not defined.</p>';
        }

        html += '</div>';

        document.getElementById('tab_TargetsTab').innerHTML = 'Targets (' + capability_targets.length + ')';
        document.getElementById('Targets').innerHTML = html;
    }

    function addSummaryTimeline() {
        const monthsMap = {};

        capability.discussions.forEach(discussion => {
            const id = discussion.date;
            if (!monthsMap[id]) {
                monthsMap[id] = [];
            }
            monthsMap[id].push(discussion);
        });

        let html = '';
        html += '<table style="font-size: 70%; color: grey; text-align: center">';

        const currentTime = new Date();
        const currentYear = currentTime.getFullYear();
        const currentMonth = currentTime.getMonth() + 1;

        html += '<tr>';
        for (let year = currentYear; year >= 2021; year--) {
            for (let month = (year === currentYear ? currentMonth : 12); month >= 1; month--) {
                const id = year + '-' + (month < 10 ? '0' : '') + month;
                let count = monthsMap[id] ? monthsMap[id].length : 0;
                html += '<td style="vertical-align: bottom;">';
                html += '<div style="width: 12px; ">' + (count > 0 ? count : '') + '</div>';
                html += '<div style="width: 12px; background-color: blue; height: ' + (count * 5) + 'px"></div>';
                html += '</td>';
            }
        }
        html += '</tr>';

        html += '<tr>';
        for (let year = currentYear; year >= 2021; year--) {
            for (let month = (year === currentYear ? currentMonth : 12); month >= 1; month--) {
                if (month === 1) {
                    html += '<td style="text-align: center; border-right: 1px solid grey">' + month + '</td>';
                } else {
                    html += '<td style="text-align: center">' + month + '</td>';
                }
            }
        }
        html += '</tr>';

        html += '<tr>';
        for (let year = currentYear; year >= 2021; year--) {
            html += '<td colspan="' + (year === currentYear ? currentMonth : 12) + '" style="text-align: center;">' + year + '</td>';
        }
        html += '</tr>';

        html += '</table>';

        return html;
    }

    function addDiscussions() {
        let discussionsOnly = capability.discussions.filter(d => d.type && !(d.type.toLowerCase().trim() === 'common themes'));
        if (discussionsOnly.length === 0) {
            html += '<div style="margin: 20px">No documented discussions.</div>';
            return;
        }
        html += '<div  class="group">';
        html += '<div style="font-size: 200%; margin-bottom: 12px">' +
            'RFCs, ADRs, TDRs, Security Reviews' +
            '</div>';

        let commonThemes = capability.discussion_summary ? capability.discussion_summary : [];
        if (discussionsOnly) {
            html += addSummaryTimeline();
            html += '<hr>';
            discussionsOnly.reverse().forEach(discussion => {
                const type = discussion.type.toLowerCase().replace(' ', '_');
                const title = discussion.date + ': ' + discussion.title + '\n\n' + discussion.summary;
                html += '<a target="_blank" href="' + discussion.link + '" title="' + title + '">';
                const border = discussion.highlight ? '2px solid crimson; margin: 2px;' : '1px solid lightgrey; margin: 3px;';
                html += '<div style="display: inline-block; border: ' + border + ';width: 100px; text-align: center; vertical-align: top; padding: 2px; max-height: 120px; overflow: hidden">';
                html += '<div style="font-size: 70%">' + discussion.date + '</div>';
                html += '<img style="width: 40px; margin: 8px" src="icons/change_log_' + type + '.png">';
                html += '<div style="font-size: 70%">' + discussion.title + '</div>';
                html += '</div>';
                html += '</a>';
            });
            html += '<hr>';

            html += '<table style="margin-top: 24px; font-size: 110%;">';
            html += '</tr>';
            html += '<tr>';
            html += '<td style="width: 440px;"></td>';
            html += '<td style="text-align: center; padding: 0px;"></td>';
            html += '<td style="width: 440px;"></td>';
            html += '</tr>';
            let index = 0;

            const yearColors = {
                '2022': '#b0b0b0',
                '2023': '#e0e0e0',
                '2024': '#f0f0f0',
                '2025': 'skyblue',
                '2026': 'skyblue',
            }

            document.getElementById('tab_DiscussionsTab').innerHTML = 'Decisions &amp; Discussions (' + discussionsOnly.length + ')';

            discussionsOnly.forEach(discussion => {
                index += 1;
                const type = discussion.type.toLowerCase().replace(' ', '_');
                const date = discussion.date;
                const label = discussion.title;
                const link = discussion.link;
                const description = discussion.summary;
                const highlight = discussion.highlight;

                function describe(type, label, description, highlight) {
                    let html = '';
                    const border = highlight ? 'border: 3px dashed crimson;' : 'border: 2px dashed #d0d0d0;';
                    html += '<div style="text-align: left; background-color: #f8f8f8; ' + border + '; box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px; padding: 8px; border-radius: 10px; margin: 12px">'
                    html += '<a target="_blank" href="' + link + '">';
                    html += '<div style="color: grey; font-size: 70%;"><span style="background-color: yellow;">' + type.toUpperCase().replace('_', ' ') + '</span></div>';
                    html += '<div style="color: blue; font-size: 131%;">';
                    html += discussion.title;
                    html += '</div>';
                    if (description && description.length > 0) {
                        if (description && description.length > 0) {
                            html += '<div style="margin: 1px; font-size: 90%; color: #404040; padding: 3px; ">';
                            html += '<ul style="margin-left: -20px">';
                            const lines = description.split(". ");
                            lines.forEach(line => {
                                hightlight.forEach(h => {
                                    line = line.replace('\\"', '"')
                                    line = line.replace(h, '<span style="background-color: yellow">' + h + '</span>')
                                });
                                html += '<li style="margin-bottom: 10px">' + line + '</li>';
                            });
                            if (highlight) {
                                html += '<li style="margin-bottom: 10px; color: crimson">HIGHLIGHT: ' + highlight + '</li>';
                            }
                            html += '</ul>';
                            html += '</div>';
                        }

                        html += '</div>';
                    }
                    html += '</a>';
                    html += '</div>';
                    return html;
                }


                if (date && label && link) {
                    let testLabel = label.toLowerCase();
                    const labelStyle = testLabel.includes('deprecated') || testLabel.includes('withdraw') || testLabel.includes('rejected') || testLabel.includes('stopped') ? 'text-decoration: line-through; opacity: 0.5;' : '';

                    const left = index % 2 == 1;

                    const bgColor = yearColors[date.substring(0, 4)];

                    html += '<tr>';
                    html += '<td style="text-align: right; ' + labelStyle + '">';
                    if (left) {
                        html += describe(type, label, description, highlight);
                    }
                    if (!left) {
                        html += '<img style="width: 80px; margin: 8px" src="icons/change_log_' + type + '.png">';
                    }
                    html += '</td>';
                    html += '<td>';
                    html += '<div style="text-align: center; vertical-align: middle; background-color: ' + bgColor + '; border-radius: 50%; height: 102px; width: 102px; white-space: nowrap"><div style="padding-top: 41px">' + date + '</div></div>';
                    html += '</td>';
                    html += '<td style="' + labelStyle + '">';
                    if (left) {
                        html += '<img style="width: 80px; margin: 8px" src="icons/change_log_' + type + '.png">';
                    }
                    if (!left) {
                        html += describe(type, label, description, highlight);
                    }
                    html += '</td>';
                    html += '</tr>';
                }
            });
            html += '</table>';

            if (commonThemes && commonThemes.length) {
                html += '<hr>';
                html += '<div style="width: 800px">';
                html += '<div style="border: 3px dashed black; padding: 10px; margin: 10px; border-radius: 10px">';
                html += '<h2 style="margin-top: 4px">Summary of Common Themes (Generated)</h2>';
                html += '<div>';
                commonThemes.forEach(line => {
                    html += '<div style="margin-bottom: 14px; line-height: 22px; margin-bottom: 32px; padding-left: 30px;">';
                    let count = 0;
                    while (line.includes('**')) {
                        let n = line.indexOf('**')
                        let tags = count % 2 == 0 ? '<div style="margin-left: -20px; margin-bottom: 12px; font-size: 131%; color: blue; background-color: white"><b>' : '</b></div>';
                        let remainder = line.substring(n + 2);
                        if (remainder.startsWith(':')) {
                            remainder = remainder.substring(1).trim();
                        }
                        line = line.substring(0, n) + tags + remainder;

                        count += 1;
                    }
                    hightlight.forEach(h => {
                        line = line.replace('\\"', '"')
                        line = line.replace(h, '<u style="background-color: yellow">' + h + '</u>')
                    });
                    html += line;
                    html += '</div>';
                });
                html += '</div>';
                html += '</div>';
                html += '</div>';
            }
        } else {
            html += '<p style="color: grey">No change documentation provided.</p>';
        }
        html += '</div>';
    }

    function addProductReviews() {
        html += '<div  class="group">';
        html += '<div style="font-size: 200%; margin-bottom: 12px">' +
            '<a target="_blank" href="https://brand.comproduct_reviews/index.html">' +
            'Product Review Evidence' +
            '</a>' +
            '</div>';
        const filtered_reviews = product_reviews.filter(g => g.reviews.length);
        if (filtered_reviews.length) {
            html += '<table style="margin-top: 24px">';
            html += '<tr>';
            let first = true;
            filtered_reviews.forEach(group => {
                html += '<td style="text-align: center; font-size: 120%; color: lightgrey">';
                html += '<div style="border-bottom: 3px dashed lightgrey; margin-left: 10px; margin-right: 10px">';
                const style = first ? 'font-size: 140%;' : '';
                html += '<div style="color: black;' + style + '">PR #' + group.id + '</div>';
                html += '<div style="color: grey; font-size: 85%">' + group.info + '</div>';
                html += '</div>';
                html += '</td>';
                first = false;
            });
            html += '</tr>';
            html += '<tr>';
            first = true;
            product_reviews.filter(g => g.reviews.length).forEach(group => {
                html += '<td style="vertical-align: top">';
                group.reviews.forEach(review => {
                    html += '<div style="vertical-align: top">';
                    html += '<a target="_blank" href="/resources/product_reviews/pr_' + group.id + '/index.html?image=' + review.page + '">';
                    const imageClass = first ? 'review-image' : 'review-image-small';
                    html += '<img class="' + imageClass + '" src="/resources/product_reviews/pr_' + group.id + '/' + review.page + '.png">';
                    html += '</a>';
                    html += '</div>';
                });
                html += '</td>';
                first = false;
            });
            html += '</tr>';
            html += '</table>';
        } else {
            html += '<p style="color: grey">No product review evidence provided.</p>';
        }
        html += '</div>';
    }

    function addPlanning() {
        html += '<div  class="group">';
        html += '<div style="font-size: 200%; margin-bottom: 12px">' +
            '<a target="_blank" href="https://brand.complanning/index/index.html">' +
            'Planning Evidence' +
            '</a>' +
            '</div>';

        let filtered_plans = planning.filter(c => c.initiatives.length);
        if (filtered_plans.length) {
            html += '<table style="margin-top: 24px">';
            html += '<tr>';
            let first = true;
            filtered_plans.forEach(cycle => {
                html += '<td style="text-align: center; font-size: 120%; color: lightgrey;">';
                html += '<div style="border-bottom: 3px dashed lightgrey; margin-left: 10px; margin-right: 10px">';
                const style = first ? 'font-size: 140%;' : '';
                html += '<div style="color: black;' + style + '">Cycle #' + cycle.cycle + '</div>';
                html += '<div style="color: grey; font-size: 85%">' + cycle.info + '</div>';
                html += '</div>';
                html += '</td>';
                first = false;
            });
            html += '</tr>';
            html += '<tr>';

            first = true;
            planning.filter(c => c.initiatives.length).forEach(cycle => {
                const width = first ? 400 : 300;
                html += '<td style="vertical-align: top; width: ' + width + 'px">';
                cycle.initiatives.forEach(initiative => {
                    let style = 'overflow: hidden; vertical-align: top;border: 1px solid black;  margin: 16px; padding: 16px; background: #f8f8f8; display: inline-block;box-shadow: rgba(50, 50, 93, 0.25) 0px 6px 12px -2px, rgba(0, 0, 0, 0.3) 0px 3px 7px -3px;';
                    if (first) {
                        style += '; font-size: 110%';
                    } else {
                        style += '; font-size: 90%; color: #a0a0a0;';
                    }
                    html += '<div style="' + style + '; width: calc(100% - 70px)">';
                    html += '<table><tr><td>';
                    html += '<img src="icons/planning.png" style="width: 42px; margin-right: 12px;">';
                    html += '</td><td style="vertical-align: top">';
                    if (initiative.link) {
                        html += '<a target="_blank" href="' + initiative.link + '">';
                    }
                    html += initiative.initiative_name;
                    if (initiative.link) {
                        html += '</a>';
                    }
                    html += '</td></tr>';
                    if (initiative.assignee || initiative.reporter) {
                        const people = [];

                        if (initiative.assignee) {
                            people.push(initiative.assignee)
                        }

                        if (initiative.reporter && !people.includes(initiative.reporter)) {
                            people.push(initiative.reporter);
                        }
                        html += '<tr>';
                        html += '<td></td>';
                        html += '<td>';
                        people.forEach(person => {
                            html += '<a target="_blank" href="https://brand.comworkday/index.html?filter=' + person + '">';
                            html += '<div class="person" style="max-width: 60px; white-space: break-spaces">';
                            html += '<div><img src="people/' + person + '.jpeg" ' +
                                'style="width: 58px; border-radius: 50%; border: 1px solid black;"' +
                                'onerror="this.onerror=null;this.src=\'icons/person.png\';"\n></div>';
                            html += '<div style="font-size: 90%">' + person + '</div>';
                            html += '</div>';
                            html += '</a>';
                        });
                        html += '</td>';
                        html += '</tr>';
                    }
                    html += '</table>';
                    html += '</div>';
                });
                html += '</td>';
                first = false;
            });
            html += '</tr>';
            html += '</table>';
        } else {
            html += '<p style="color: grey">No planned initiatives provided.</p>';
        }
        html += '</div>';
    }

    function isRepoNameCompliant(repo) {
        repo = repo.replace(/.*\//g, '').trim();

        const compliantPrefixes = ['Brand_seeker', 'Brand_owner', 'Brand_intermediary', 'Brand_mpd', 'Brand_platform', 'Brand_architecture', 'Brand_data', 'Brand_security', 'Brand_hackathon', 'Brand_internal'];

        for (let prefix of compliantPrefixes) {
            if (repo.startsWith(prefix + '_')) return true;
            if (repo.startsWith(prefix + '-')) return true;
        }

        return false;
    }

    function addImplementationEvidence() {
        html += '<div  class="group">';
        html += '<div style="font-size: 200%; margin-bottom: 12px">Implementation Evidence</div>';

        html += '<div style="font-size: 150%; margin-bottom: 12px; margin-top: 32px; margin-left: 12px">Source Code Repositories</div>';
        let reposCount = 0;
        let awsCount = 0;
        if (capability.source_code_repositories) {
            let repos = capability.source_code_repositories.trim().split('\n');
            html += '<div style="display: flex; align-items: center; font-size: 131%; margin-top: 32px; margin-bottom: 18px; margin-left: 12px"><img class="icon" style="width: 50px;" src="icons/atlas.png"><a target="_blank" href="/sokrates/reports/landscape-per-capability/' + capability.id + '/_sokrates_landscape/index.html">Capability Source Code Landscape (' + repos.length + ')</a></div>';
            reposCount = repos.length;
            if (repos.length) {
                html += '<table class="repo">';
                html += '<tr>';
                html += '<td rowspan="' + (repos.length + 1) + '">';
                html += '<img src="icons/github.png" style="width: 78px; margin: 18px">';
                html += '</td>';
                html += '</td>';
                html += '</tr>';
                repos.forEach(repo => {
                    if (repo.trim() === '') {
                        html += '<tr>';
                        html += '<td style="height: 24px">';
                        html += '<hr>';
                        html += '</td>';
                        html += '</tr>';
                        return;
                    }
                    html += '<tr>';
                    html += '<td style="vertical-align: middle">';
                    html += '<img src="icons/repo.png" style="width: 32px; margin-right: 1px; margin-top: 8px">';
                    html += '</td>';
                    html += '<td style="vertical-align: middle">';
                    html += '<td>';
                    html += '<div>';
                    html += '<a target="_blank" href="https://github.com/' + repo.replace(/\,.*/, '').trim() + '" ">';
                    html += repo;
                    html += '</a>';
                    html += '</td>';
                    html += '<td style="padding-left: 34px; padding-right: 4px">';
                    const repoName = repo.split('/');
                    const prefix = 'https://brand.comsokrates/reports/';
                    html += '<a target="_blank" href="' + prefix + repo.replace(/\,.*/, '').trim() + '/html/index.html" ">';
                    html += '<img src="icons/analysis.png" style="width: 30px; margin-right: 8px; margin-top: 6px">';
                    html += '<div style="font-size: 9px; text-align: center">report</div></a>';
                    html += '</td>';
                    html += '<td>';
                    let compliant = isRepoNameCompliant(repo);
                    html += '<a href="https://brand.comgolden-paths/names/index.html" target="_blank"><img src="icons/' + (compliant ? 'compliant' : 'not-compliant') + '.png" style="width: 20px; margin: 3px" title="the repository name is ' + (compliant ? '' : 'NOT ') + 'compliant with the Brand naming conventions"></a>';
                    html += '</td>';
                    html += '</tr>';
                });
                html += '</table>';
            } else {
                html += '<p style="color: grey; margin-left: 12px">No source code evidence provided.</p>';
            }
        } else {
            html += '<p style="color: grey; margin-left: 12px">No source code evidence provided.</p>';
        }
        if (capability.legacy_source_code_repositories) {
            html += '<div style="display: flex; align-items: center; font-size: 131%; margin-top: 32px; margin-bottom: 18px; margin-left: 12px"><img class="icon" style="width: 50px;" src="icons/atlas.png"><a target="_blank" href="/sokrates/reports/landscape-per-capability/legacy_' + capability.id + '/_sokrates_landscape/index.html">Legacy Source Code Landscape</a></div>';
            let repos = capability.legacy_source_code_repositories.trim().split('\n');
            html += '<div style="font-size: 150%; margin-bottom: 12px; margin-top: 32px; margin-left: 12px">Legacy Source Code Repositories (' + repos.length + ')</div>';
            reposCount += repos.length;
            if (repos.length) {
                html += '<table class="repo">';
                html += '<tr>';
                html += '<td rowspan="' + (repos.length + 1) + '">';
                html += '<img src="icons/github.png" style="width: 78px; margin: 18px">';
                html += '</td>';
                html += '</td>';
                html += '</tr>';
                repos.forEach(repo => {
                    html += '<tr>';
                    html += '<td style="vertical-align: middle">';
                    html += '<img src="icons/repo.png" style="width: 32px; margin-right: 1px; margin-top: 8px">';
                    html += '</td>';
                    html += '<td style="vertical-align: middle">';
                    html += '<td>';
                    html += '<div>';
                    html += '<a target="_blank" href="https://github.com/' + repo.replace(/\,.*/, '').trim() + '" ">';
                    html += repo;
                    html += '</a>';
                    html += '</td>';
                    html += '<td style="padding-left: 34px; padding-right: 4px">';
                    const repoName = repo.split('/');
                    const prefix = 'https://brand.comsokrates/reports/';
                    html += '<a target="_blank" href="' + prefix + repo.replace(/\,.*/, '').trim() + '/html/index.html" ">';
                    html += '<img src="icons/analysis.png" style="width: 30px; margin-right: 8px; margin-top: 6px">';
                    html += '<div style="font-size: 9px; text-align: center">report</div></a>';
                    html += '</td>';
                    html += '<td>';
                    let compliant = isRepoNameCompliant(repo);
                    html += '<a href="https://brand.comgolden-paths/names/index.html" target="_blank"><img src="icons/' + (compliant ? 'compliant' : 'not-compliant') + '.png" style="width: 20px; margin: 3px" title="the repository name is ' + (compliant ? '' : 'NOT ') + 'compliant with the Brand naming conventions"></a>';
                    html += '</td>';
                    html += '</tr>';
                });
                html += '</table>';
            } else {
                html += '<p style="color: grey; margin-left: 12px">No legacy source code evidence provided.</p>';
            }
        } else {
            html += '<div style="font-size: 150%; margin-bottom: 12px; margin-top: 32px; margin-left: 12px">Legacy Source Code Repositories (0)</div>';
            html += '<p style="color: grey; margin-left: 12px">No legacy source code evidence provided.</p>';
        }
        if (capability.aws_accounts || capability.aws_workspace_config_path) {
            let awsAccounts = capability.aws_accounts ? capability.aws_accounts.trim().split('\n') : [];
            awsCount = awsAccounts.length;
            html += '<div style="font-size: 150%; margin-top: 32px; margin-bottom: 18px; margin-left: 12px"><a target="_blank" href="https://brand.comaws/linked_accounts/index.html">AWS Workspaces (' + awsAccounts.length + ')</a></div>';
            if (awsAccounts.length || capability.aws_workspace_config_path) {
                html += '<table class="aws">';
                if (awsAccounts.length > 1) {
                    let accountParams = awsAccounts.map(a => a.replace(/\,.*/, '')).join(',');
                    html += '<tr style="">';
                    html += '<td style="vertical-align: middle; width: 42px;">';
                    html += '<img src="icons/aws.png" style="border-radius: 4px; padding: 4px; border: 1px solid orange; width: 32px; margin-right: 8px; margin-top: 6px">';
                    html += '</td>';
                    html += '<td style="vertical-align: middle; padding-right: 20px; background-color: #f0f0f0; padding-left: 5px; font-size: 120%">';
                    html += '<a target="_blank" href="https://brand.comaws/linked_accounts/trends.html?filter=' + accountParams + '">';
                    html += awsAccounts.length + ' Workspaces';
                    html += '</a>';
                    html += '</td>';
                    html += '<td style="background-color: #f0f0f0">';
                    html += 'graphs: ';
                    html += '<a target="_blank" href="https://brand.comawsexplorer/visuals/links-2d.html?filter=' + accountParams + '&excludeIndirectAccounts=true">';
                    html += 'repositories';
                    html += '</a> | ';
                    html += '<a target="_blank" href="https://brand.comawsexplorer/visuals/links-2d.html?filter=' + accountParams + '&excludeIndirectAccounts=false">';
                    html += 'repositories+other accounts';
                    html += '</a> | ';
                    html += '<a target="_blank" href="https://brand.comawsexplorer/visuals/indirect-links-2d.html?filter=' + accountParams + '">';
                    html += 'other accounts';
                    html += '</a>';
                    html += '</td>';
                    html += '</tr>';
                }
                awsAccounts.forEach(account => {
                    html += '<tr>';
                    html += '<td style="vertical-align: middle; width: 42px;">';
                    html += '<img src="icons/aws.png" style="border-radius: 4px; padding: 4px; border: 1px solid orange; width: 32px; margin-right: 8px; margin-top: 6px">';
                    html += '</td>';
                    html += '<td style="vertical-align: middle; padding-right: 20px">';
                    html += '<a target="_blank" href="https://brand.comaws/linked_accounts/trends.html?filter=' + account.replace(/\,.*/, '') + '">';
                    html += awsAccounts.length > 1 ? '&nbsp;&nbsp;&nbsp;&nbsp;' : '';
                    html += account;
                    html += '</a>';
                    html += '</td>';
                    html += '<td>';
                    html += 'graphs: ';
                    html += '<a target="_blank" href="https://brand.comawsexplorer/visuals/links-2d.html?filter=' + account.replace(/\,.*/, '') + '">';
                    html += 'repositories';
                    html += '</a> | ';
                    html += '<a target="_blank" href="https://brand.comawsexplorer/visuals/links-2d.html?filter=' + account.replace(/\,.*/, '') + '">';
                    html += 'repositories+other accounts';
                    html += '</a> | ';
                    html += '<a target="_blank" href="https://brand.comawsexplorer/visuals/indirect-links-2d.html?filter=' + account.replace(/\,.*/, '') + '">';
                    html += 'other accounts';
                    html += '</a>';
                    html += '</td>';
                    html += '</tr>';
                });
                if (capability.aws_workspace_config_path) {
                    capability.aws_workspace_config_path.trim().split('\n').forEach(config => {
                        html += '<tr>';
                        html += '<td style="vertical-align: middle; text-align: center; border-top: 1px solid lightgrey">';
                        html += '<img src="icons/config.png" style="width: 32px; margin-right: 8px; margin-top: 6px">';
                        html += '</td>';
                        html += '<td style="vertical-align: middle; padding-right: 20px; text-align: left; border-top: 1px solid lightgrey">';
                        const prefix = 'https://github.com/axel-springer-kugawana/Brand-foundation-workspace-config/blob/main/workspaces/';
                        html += '<a target="_blank" href="' + prefix + config + '" ">';
                        html += config;
                        html += '</a>';
                        html += '</td>';
                        html += '<td style="vertical-align: middle; padding-right: 20px; text-align: center; border-top: 1px solid lightgrey">';
                        html += '</td>';
                        html += '</tr>';
                    });
                }
                html += '</table>';
            } else {
                html += '<p style="color: grey; margin-left: 12px">No AWS evidence provided.</p>';
            }
        } else {
            html += '<div style="font-size: 150%; margin-top: 32px; margin-bottom: 18px; margin-left: 12px"><a target="_blank" href="https://brand.comaws/linked_accounts/index.html">AWS Workspaces (0)</a></div>';
            html += '<p style="color: grey; margin-left: 12px">No AWS evidence provided.</p>';
        }

        html += '</div>';

        document.getElementById('tab_ImplementationTab').innerHTML = 'Implementation (' + reposCount + '+' + awsCount + ')';
    }

    function addDependencies() {
        html += '<div  class="group">';
        html += '<div style="font-size: 200%; margin-bottom: 12px"><a target="_blank" href="https://brand.comcapabilities/index.html#Synergies">Target WL Dependencies</a></div>';

        function statusOf(dependency) {
            let status = 4;
            return status;
        }

        first = true;
        if (dependencies.length || reverse_dependencies.length) {
            html += '<table>';
            let first = true;
            reverse_dependencies.sort((a, b) => statusOf(b) - statusOf(a)).filter(d => !d.capability.toLowerCase().includes('legacy')).forEach(dependency => {
                const status = statusOf(dependency);

                html += '<tr>';

                if (first) {
                    html += '<td rowspan="100" style="width: 100px; text-align: center; padding-right: 26px">';
                    html += '<img src="icons/' + capability.id + '.png" style="height: 78px; margin: 12px">';
                    html += '<div style="font-size: 80%; color: grey">' + capability.capability + '</div>';
                    html += '</td>';
                    first = false;
                }

                html += '<td style="padding-right: 14px; padding-right: 32px; vertical-align: middle">';
                const extraStyle = status >= 3 ? '' : 'opacity: 0.2';
                html += '<img src="icons/dependency-from.png" style="height: 30px; ' + extraStyle + '">';
                html += '</td>';

                html += '<td style="padding-right: 14px">';
                if (dependency.image_id) {
                    html += '<img src="icons/' + dependency.image_id + '.png" style="height: 38px">';
                }
                html += '</td>';
                html += '<td style="vertical-align: top">';
                html += '<div style="color: grey; padding-right: 12px; font-size: 80%">';
                html += dependency.source;
                html += '</div>';
                if (dependency.image_id) {
                    html += '<a href="' + dependency.image_id + '.html">';
                }
                html += dependency.capability;
                if (dependency.image_id) {
                    html += '</a>';
                }
                html += '</td>';
                html += '<td style="">';
                html += '<img src="icons/synergy.png" class="dependency-icon">';
                html += '</td>';
                html += '<td style="color: grey; font-size: 90%">';
                html += dependency.note ? dependency.note : '';
                html += '</td>';
                html += '</tr>';
            });
            dependencies.sort((a, b) => statusOf(b) - statusOf(a)).forEach(dependency => {
                const status = statusOf(dependency);

                html += '<tr>';
                if (first) {
                    html += '<td rowspan="100" style="width: 100px; text-align: center; padding-right: 26px">';
                    html += '<img src="icons/' + capability.id + '.png" style="height: 78px; margin: 12px">';
                    html += '<div style="font-size: 80%; color: grey">' + capability.capability + '</div>';
                    html += '</td>';
                    first = false;
                }

                html += '<td style="padding-right: 14px; padding-right: 32px; vertical-align: middle">';
                const extraStyle = status >= 3 ? '' : 'opacity: 0.2';
                html += '<img src="icons/dependency-to.png" style="height: 30px; ' + extraStyle + '">';
                html += '</td>';
                html += '<td style="padding-right: 14px; vertical-align: middle">';
                if (dependency.image_id) {
                    html += '<img src="icons/' + dependency.image_id + '.png" style="height: 38px">';
                }
                html += '</td>';
                html += '<td style="padding-right: 14px; vertical-align: middle">';
                html += '<div style="color: grey; padding-right: 12px; font-size: 80%">';
                html += dependency.dependency_domain;
                html += '</div>';
                if (dependency.image_id) {
                    html += '<a href="' + dependency.image_id + '.html">';
                }
                html += dependency.dependency;
                if (dependency.image_id) {
                    html += '</a>';
                }
                html += '</td>';

                html += '<td style="color: grey; font-size: 90%">';
                html += dependency.note ? dependency.note : '';
                html += '</td>';
                html += '</tr>';
            });
            html += '</table>';
        } else {
            html += '<p style="color: grey">No dependecy data provided.</p>';
        }

        html += '</div>';

        document.getElementById('tab_DependenciesTab').innerHTML = 'Dependencies (' + dependencies.length + ')';
    }

    function getBrandsCountryIcon(brand) {
        if (!brand) return '';

        let html = '';
        brand = brand.toLowerCase().trim();
        let iconLink = 'icons/capability.png';
        if (brand.includes('brand_a')) iconLink = '../../assets/icons/brands/iwt.png';
        else if (brand.includes('brand_b')) iconLink = '../../assets/icons/brands/imn.png';
        else if (brand.includes('logicimmo')) iconLink = '../../assets/icons/brands/li.png';
        else if (brand.includes('seloger')) iconLink = '../../assets/icons/brands/slg.png';
        else if (brand.includes('immoweb')) iconLink = '../../assets/icons/brands/iwb.png';
        else if (brand.includes('meilleurs')) iconLink = '../../assets/icons/brands/ma.png';
        else if (brand.includes('residence')) iconLink = '../../assets/icons/brands/lr.png';
        else if (brand.includes('demeures')) iconLink = '../../assets/icons/brands/bd.png';
        else if (brand.includes('germany')) iconLink = 'https://zeljkoobrenovic.github.io/sokrates-media/flags/4x3/un.svg';
        else if (brand.includes('france')) iconLink = 'https://zeljkoobrenovic.github.io/sokrates-media/flags/4x3/un.svg';
        else if (brand.includes('belgium')) iconLink = 'https://zeljkoobrenovic.github.io/sokrates-media/flags/4x3/un.svg';
        else if (brand.includes('country_4')) iconLink = 'https://zeljkoobrenovic.github.io/sokrates-media/flags/4x3/at.svg';
        else if (brand.includes('all')) iconLink = 'https://zeljkoobrenovic.github.io/sokrates-media/flags/4x3/eu.svg';
        if (iconLink) {
            html += '<img src="' + iconLink + '" style="border: 1px solid #d0d0d0; height: 35px; width: 46px; object-fit: cover">';
        }
        return html;
    }

    function addTechDebt() {
        let html = '';

        html += '<table style="margin: 20px">';

        tech_debt.sort((a, b) => a.brand.localeCompare(b.brand)).forEach(item => {
            html += '<tr>';
            html += '<td style="vertical-align: middle; color: blue; text-align: right; padding-right: 4px;">';
            if (item.brand) {
                html += getBrandsCountryIcon(item.brand);
            }
            html += '</td>';
            html += '<td style="padding-right: 12px; ">' + item.brand + '</td>';
            html += '<td style="padding-right: 8px; color: grey; text-align: right">' + (item.type ? item.type : '-') + '</td>';
            html += '<td>' + item.legacy_system + '</td>';
            html += '</tr>';
        });
        html += '</table>';

        document.getElementById('TechDebt').innerHTML = html;
        document.getElementById('tab_TechDebtTab').innerHTML = 'Tech Debt (' + tech_debt.length + ')</td>';
    }

    addDocs();
    document.getElementById('Header').innerHTML = html;
    html = '';

    addPeople();
    addMilestones();
    html += addRoadmap();
    addProductReviews();
    addPlanning();
    document.getElementById('Home').innerHTML = html;
    html = '';

    addDiscussions();
    document.getElementById('RFCs').innerHTML = html;
    html = '';

    addImplementationEvidence();
    document.getElementById('Implementation').innerHTML = html;
    html = '';
    addDependencies();
    document.getElementById('Dependencies').innerHTML = html;

    addTechDebt();
</script>
<div style="margin: 30px; font-size: 80%; color: grey">
    <p>data sources:</p>
    <ul>
        <li><a target="_blank"
               href="">
            main capabilities sheet (basic data per capability)</a></li>
        <li><a target="_blank" style="color: grey"
               href="">
            capabilities' release targets (including OKR targets)</a></li>
        <li><a target="_blank" style="color: grey"
               href="">
            capabilities' decision & discussion documents</a></li>
        <li><a target="_blank" style="color: grey"
               href="">
            target synergies and dependencies sheet</a></li>
        <li><a target="_blank" style="color: grey"
               href="">
            product reviews index sheet</a></li>
        <li><a target="_blank" style="color: grey"
               href="">
            planning index sheet</a></li>
    </ul>
</div>
</body>
</html>